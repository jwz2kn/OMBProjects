<html>
<head>
    <script type="text/javascript"
            src="https://www.google.com/jsapi?autoload={
            'modules':[{
              'name':'visualization',
              'version':'1',
              'packages':['corechart', 'table', 'map']
            }]
          }"></script>
    <script type="text/javascript">
        //google.load('visualization', '1', {'packages': ['table', 'map', 'corechart']});
        //google.setOnLoadCallback(initialize);



            // The URL of the spreadsheet to source data from.
            // "create" the data table
            // SET THE RANGE OF THE URL to cover the columns A through (some_Letter) to create a bar graph with that many columns for the same x-axis entry
        //var queryString = encodeURIComponent('SELECT H:M')

        /* WARNING WARNING WARNING: COLUMN K WILL BREAK THE CODE BECAUSE IT HAS DIFFERENT FORMATTING */
        // note that the end range value includes the values for the next column too
        // and the start column gets the column ahead of it too
        // THAT DOESN'T MAKE SENSE TO ME, BUT THAT'S THE CASE HERE --> UPDATE: I used the wrong page of the worksheet - I have no idea why the GID is not working
        // to let me access the specific page of the spreadsheet. It has really been throwing off my coding and progress
       
        var query = new google.visualization.Query(
           'https://docs.google.com/spreadsheets/d/162mgBt9bYZRqdtahKdnuD2PDqDPHcJuXAC1JAVo1vA4/edit?usp=sharing/gviz/tq?&range=B:K&gid=1521108462');

         


            query.send(draw);



        // draws the Chart that shows total expenditures
        function draw(response) {
            if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
            }

            var budgetData = response.getDataTable();
            // move this following this line
            var view = new google.visualization.DataView(budgetData);
            view.hideColumns([1, 2, 3, 4, 5, 6, 7, 8]);
            view.hideRows([10, 11]);
           
            /*
            Failed attempt at getting only one "Albemarle" column to show up
            for (var i = 0; i < selection.length; i++) {
                // check to see which locality was clicked
                var item = selection[i];
                if (selection[i].row != 0 && selection[i].row.getValue() == "Albemarle") {
                    view.hideColumns([i]);
                }
            }*/
            var bigChart = new google.visualization.ColumnChart(document.getElementById('totalchart_div'));
            bigChart.draw(view, {
                'title': 'Comparative Total Expenditures of Benchmark Localities ($) Version 2.2',
                'colors': ['limegreen', 'royalblue', 'gold', 'red', 'orange', 'purple', 'mediumturquoise', 'lightslategray'],
                'legend': {position: 'none'},
                'animation': {"startup": true}

            });

            console.log("Chart with all localities' expenditures columns A:J - number of columns: " + budgetData.getNumberOfColumns());
            console.log("Chart with all localities' expenditures rows - number of columns: " + budgetData.getNumberOfColumns());
            // TODO: Unsuccessful thus far in getting a click on a certain bar to just show that locality's expenditures, but can show all expenditure data of all localities
            function myClickHandler() {
                window.scrollTo(0, document.body.scrollHeight);
                if (document.getElementById("cchart_div").style.display == 'none' || 
                    document.getElementById("pchart_div").style.display == 'none') {
                    document.getElementById("cchart_div").style.display = '';
                    //document.getElementById("pchart_div").style.display = '';
                    window.scrollTo(0, document.body.scrollHeight);
                }
                var selection = bigChart.getSelection();
                for (var i = 0; i < selection.length; i++) {
                    // check to see which locality was clicked
                    var item = selection[i];
                    query.send(drawLocality(response, selection[i].row));
                }
            }

            google.visualization.events.addListener(bigChart, 'select', myClickHandler);
        }

        function drawLocality(response, chartNum) {
            if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
            }

            var budgetData = response.getDataTable();

            var view = new google.visualization.DataView(budgetData);
            view.hideColumns([9, 10]);
            view.hideRows(view.getViewRows());
            view.setRows([chartNum]);
            var bigChart = new google.visualization.ColumnChart(document.getElementById('cchart_div'));
            bigChart.draw(view, {
                'title': 'County Expenditures Per Person ($)',
                'colors': ['limegreen', 'royalblue', 'gold', 'red', 'orange', 'purple', 'mediumturquoise', 'lightslategray']
            });
            /*
            var pChartView = new google.visualization.DataView(budgetData);
            pChartView.hideColumns([9, 10]);
            pChartView.hideRows(view.getViewRows());
            pChartView.setRows([chartNum]);
            pChartView.getTableRowIndex(chartNum);
            var pChart = new google.visualization.PieChart(document.getElementById('pchart_div'));
            pChart.draw(budgetData, {
                'title': 'County Expenditures Per Person ($)',
                'colors': ['limegreen', 'royalblue', 'gold', 'red', 'orange', 'purple', 'mediumturquoise', 'lightslategray']
            });*/
        }
    </script>
</head>

<body>
    <table align="center" style="width: 95%">
        <tr align="center">
            <td colspan=2>
                <div id="totalchart_div" style="width: 100%; height: 600px;"></div>
            </td>
        </tr>
        <tr align="center">
            <td colspan=2>
                <div id="cchart_div" style="display: none; width : 100%; height: 600px;"></div>
            </td>
        </tr>
        <tr align="center">
            <td colspan=2>
                <div id="pchart_div" style="display: none; width : 100%; height: 600px;"></div>
            </td>
        </tr>
    </table>

</body>
</html>
